<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Avalia√ß√£o 360¬∞</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center p-6">
  <div class="w-full max-w-6xl bg-white shadow-xl rounded-xl p-10">
    <h1 class="text-3xl font-bold text-center text-indigo-700 mb-2">üìä Avalia√ß√£o 360¬∞</h1>
    <form id="form360" class="space-y-12">
      
      <!-- Identifica√ß√£o -->
      <section>
        <h2 class="text-2xl font-semibold mb-4">Identifica√ß√£o</h2>
        <select id="respondente" name="respondente" class="w-full border rounded p-2" required>
          <option value="">Selecione seu nome...</option>
          <option>Keila</option><option>Ariel</option><option>Dante</option><option>Alex</option>
          <option>Sayonara</option><option>Rafael</option><option>Marcus</option><option>Jaqueline</option>
          <option>Glaucio</option><option>Luc√©lio</option><option>Eduardo</option>
        </select>
      </section>

      <!-- Gerente -->
      <section>
        <h2 class="text-2xl font-semibold mb-4">1. Avalia√ß√£o do Gerente ‚Äì M√°rcio Mer√ßon</h2>
        <div id="gerente-container" class="space-y-4"></div>
      </section>

      <!-- Chefes -->
      <section>
        <h2 class="text-2xl font-semibold mb-4">2. Avalia√ß√£o dos Chefes de N√∫cleo</h2>
        <div id="maycon-container" class="space-y-4 bg-gray-50 p-4 rounded"></div>
        <div id="luciane-container" class="space-y-4 bg-gray-50 p-4 rounded mt-6"></div>
      </section>

      <!-- Colegas -->
      <section id="secaoColegas" style="display:none;">
        <h2 class="text-2xl font-semibold mb-4">3. Avalia√ß√£o entre Colegas</h2>
        <div id="colegas-container" class="space-y-10"></div>
      </section>

      <div class="text-center">
        <button type="submit" class="px-6 py-3 bg-indigo-600 text-white font-bold rounded-lg">Enviar Avalia√ß√£o</button>
      </div>
    </form>
  </div>

  <!-- Gr√°fico -->
  <div class="w-full max-w-6xl bg-white shadow-xl rounded-xl p-10 mt-10">
    <h2 class="text-2xl font-semibold mb-6">üìà Resultados (m√©dias locais)</h2>
    <canvas id="graficoResultados" height="120"></canvas>
  </div>

  <script>
    const todosColegas = ["Keila","Ariel","Dante","Alex","Sayonara","Rafael","Marcus","Jaqueline","Glaucio","Luc√©lio","Eduardo"];

    const opcoes5 = ["Muito Insatisfat√≥rio","Insatisfat√≥rio","Regular","Satisfat√≥rio","Muito Satisfat√≥rio"];
    const valores5 = [1,2,3,4,5];

    function criarSelect(name, label, obrigatorio=true, opcoes=opcoes5, valores=valores5) {
      let html = `<label class="block mb-2">${label}</label>`;
      html += `<select name="${name}" class="w-full border rounded p-2 mb-4" ${obrigatorio ? "required" : ""}>`;
      html += `<option value="">${obrigatorio ? "Selecione..." : "(Opcional) Selecione..."}</option>`;
      opcoes.forEach(opt => html += `<option>${opt}</option>`);
      html += `</select>`;
      return html;
    }

    // --- Gerente ---
    const gerentePerguntas = [
      "Mobilizar equipe","Feedback","Comunica√ß√£o","Conflitos","Empatia","Apoio","Reconhecimento",
      "Periodicidade feedback","Clima de confian√ßa","Expectativas","Resolu√ß√£o problemas","Promo√ß√£o desenvolvimento"
    ];
    document.getElementById("gerente-container").innerHTML =
      gerentePerguntas.map((p,i)=> criarSelect("gerente_"+i,p,true)).join("");

    // --- Chefes ---
    const chefePerguntas = ["Mobilizar equipe","Vis√£o clara","Desenvolvimento","Tratamento","Conflitos",
      "Di√°logo","Apoio","Diretrizes","Feedback","Inclus√£o","Gest√£o conflitos","Facilita√ß√£o","Empatia","Proatividade"];
    document.getElementById("maycon-container").innerHTML =
      "<h3 class='font-bold mb-2 text-indigo-700'>Maycon</h3>" + chefePerguntas.map((p,i)=> criarSelect("maycon_"+i,p,true)).join("");
    document.getElementById("luciane-container").innerHTML =
      "<h3 class='font-bold mb-2 text-indigo-700'>Luciane</h3>" + chefePerguntas.map((p,i)=> criarSelect("luciane_"+i,p,true)).join("");

    // --- Colegas ---
    const colegasPerguntas = ["Colabora√ß√£o","Comunica√ß√£o","Empatia","Conflitos","Proatividade"];
    const colegasContainer = document.getElementById("colegas-container");
    const secaoColegas = document.getElementById("secaoColegas");
    document.getElementById("respondente").addEventListener("change", function(){
      const resp = this.value;
      if(!resp){ secaoColegas.style.display="none"; return; }
      const colegas = todosColegas.filter(n => n!==resp);
      colegasContainer.innerHTML = colegas.map(nome=>{
        return `<div class="p-4 border rounded bg-gray-50">
          <h3 class="text-lg font-medium mb-2 text-indigo-700">${nome}</h3>
          ${colegasPerguntas.map((p,i)=> criarSelect(nome.toLowerCase()+"_"+i,p,false)).join("")}
        </div>`;
      }).join("");
      secaoColegas.style.display="block";
    });

    // --- Gr√°fico ---
    const ctx = document.getElementById("graficoResultados").getContext("2d");
    const labels = ["Gerente","Maycon","Luciane",...todosColegas];
    const grafico = new Chart(ctx, {
      type:"bar",
      data:{ labels, datasets:[{label:"M√©dia", data:Array(labels.length).fill(0), backgroundColor:"rgba(79,70,229,0.6)"}]},
      options:{ scales:{ y:{beginAtZero:true, max:5} } }
    });

    // --- Submiss√£o ---
    document.getElementById("form360").addEventListener("submit", function(e){
      e.preventDefault();
      const dados = Object.fromEntries(new FormData(this).entries());

      // envia para o backend Node (Render)
      fetch("/salvar", {
        method:"POST",
        headers:{ "Content-Type":"application/json" },
        body: JSON.stringify(dados)
      }).then(r=>r.json()).then(res=>console.log("‚úÖ Salvo:",res));

      alert("‚úÖ Avalia√ß√£o registrada!");
      this.reset();
      secaoColegas.style.display="none";
    });
  </script>
</body>
</html>
